# HealthPredict

Here is a local web service that predicts the user's well-being using machine learning methods based on current weather conditions

More detailed description (RU):
Цель проекта - создание сервиса, который, используя методы машинного обучения, позволял бы на основании текущих погодных условий определять самочувствие пользователя, основываясь на внесённой им ранее информации.

Минимальные возможности сервиса:
Основные три параметра погоды, влияющие на самочувствие человека - это давление, солнечная активность и температура. Основные симптомы метеозависимости, которые может очень легко почувствовать человек - это головная боль или отклонение внутреннего давления от нормы. Исходя из этих фактов, я решил, что минимальный функционал таков: 
-регистрация пользователя; 
-авторизация пользователя; 
-хранение данных пользователя в базе данных; 
-сбор информации о текущем атмосферном давлении и температуры в том месте, где находится пользователь, а также о наличии солнечной активности; 
-ввод пользователем данных о своём самочувствии; 
-анализ информации, уже предоставленной пользователем; 
-прогнозирование головной боли пользователя на основании атмосферного давления и наличия солнечной активности; 
- прогнозирование отклонения внутреннего давления пользователя на основании атмосферного давления и наличия солнечной активности; 
- прогнозирование общего самочувствия пользователя на основании наличия головной боли и отклонения его внутреннего давления; 

Выбор технологий:
Когда список минимальных функций сервиса был определён, можно было переходить к выбору технологий. 
В качестве основного языка программирования был выбран Python. Такое решение принято не случайно. Во-первых, под него написана очень мощная библиотека Sklearn, функционал которой позволяет использовать уже реализованные методы машинного обучения. Во-вторых, под него написан популярный для создания вебприложений фреймворк Flask, берущий на себя практически всю сложную работу с сетью. 
Немного об Sklearn. Чтобы покрыть наши потребности в составлении прогноза, хорошо подошли бы многие методы статистики и машинного обучения. Тем не мене, я принял решение использовать 
созданный в этой библиотеке GaussianNB - гауссовский наивный байесовский алгоритм для классификации, а также в качестве тестирования классификаторы Tree (дерево) и Random Forrest (случайный лес). Так как Sklearn очень хорошо работает с датафреймами библиотеки Pandas и типами данных библиотеки Numpy, то для подготовки данных были использованы именно они. 
Немного о Flask. В дополнение к этому фреймворков написано несколько библиотек, которые могут взять на себя сложную часть реализации регистрации и аутентификации пользователя. К примеру Flask-Login. Также в данном фреймоврке уже реализованы методы, позволяющие создать обработчик ошибок, и проверку на валидность полей.
В качестве базы данных была выбрана SQLite - её использование достаточно просто, так как существует sqlite3 - Python-библиотека, предоставляющая API для взаимодействия с СУБД. 
Для того, чтобы получать информацию о IP пользователя, атмосферном давлении в том месте, где находится пользователи и о наличии солнечной активности были соответственно использованы следующие API: IPData API, Openweather API, NASA API. 
Чтобы получать аватар пользователя было использовано Gravatar API. 
Для проектирования интерфейса использовался сервис Figma. Для верстки были выбраны HTML и CSS без JavaScript. 

Создание технической части 
При создании технической части проекта всё было разбито на 4 блока: роуты(пути определения для веб-сайта), модели, менеджеры и формы. 
Роуты представляют файл routers.py, который отвечает за логику обработки get и post запросов пользователя. 
Модели находятся в файле models.py - определяют, в основном, структуры данных. Иногда, например в модели User, задают логику управления данными (функции setpassword, checkpassword ... ). 
Менеджеры находятся в папку managers и отвечают за работу с API, с потоками данных, с другими менеджерами и тд. 
Особое внимание стоит уделить менеджерам:

classification_manager отвечает за обучение модели на основании ответа пользователя и погодных условий.
db_manager отвечает работу и связь с базой данных.
gaussian_NB_manager создан для обучения модели на основании наивного байесовского классификатора.
graph_manager реализует построения графика относительно самочувствия пользователя и погодных условий.
ipdata_manager получает информацию об ip пользователя, что впоследствии выводится в качестве города, а так же используется для более точного прогноза.
magnetic_storms_manager получает от серверов NASA информацию о солнечной активности в нужном нам формате.
network_manager работает с сетью. К примеру: получает город, в котором находится пользователь, его идентификатор (пользователя), его ответ на опрос о самочувствии и прочее
openweather_manager получает информацию о внешнем давлении и температуре.
tree_classificator_manager реализует методы работы с классификатором дерево принятия решений, то есть дает прогноз на основании данного классификатора.
weather_manager объединяет получение информации о метео условиях в зависимости от местоположения пользователя.


Формы - во многом, тоже модели, но ориентированные на работу с python библиотекой WTForms. 
Помимо этого существует обработчик ошибок, а так же файлы, которые реализуют работу с сетью, фласком, или какую-либо логическую часть (К примеру config и website).

Тестирование:
Для тестирования программы был создан небольшой датасет. В него были заложены некие шаблоны (непосредственно от нескольких пользователей). Например, если в определённый день атмосферное давление высокое, то у пользователя оценка общего самочувствие меньше или равна 3 из 5 баллов. В дальнейшем, алгоритму для классификации на вход подавался набор погодных условия - сервис точно угадывал в 8 из 10 случаев, какое у пользователя должно быть самочувствие в этот день (исходя из заложенных в датасет правил). 

Заключение:
Таким образом, первая рабочая версия сервиса была реализована – уже сейчас сервис может быть развернут на реальном сервере и он будет приносить пользу людям. 
